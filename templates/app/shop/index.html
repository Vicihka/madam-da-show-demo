{% load static %}
<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="MADAM DA - Premium Beauty & Cosmetics">
    <title>MADAM DA | Premium Beauty</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{% static 'common/images/favicon.png' %}">
    <link rel="shortcut icon" type="image/png" href="{% static 'common/images/favicon.png' %}">
    <link rel="apple-touch-icon" href="{% static 'common/images/favicon.png' %}">
    
    <!-- Preload critical resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    
    <!-- Fonts with optimized loading and font-display: swap -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:wght@600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="{% static 'shop/css/index.css' %}">
    
    
</head>
<body>
    
    <!-- HEADER -->
    <header>
        <div class="header-inner">
            <div class="header-left">
                <div class="menu-trigger">
                    <button class="icon-btn menu-btn" id="menu-btn" onclick="toggleMenu()" aria-label="Toggle menu" title="Toggle menu">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="3 6 18 12" stroke-width="1.5" stroke="currentColor" class="w-4 h-4" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path>
                        </svg>
                    </button>
                    <div class="dropdown-menu" id="dropdown-menu" role="menu" aria-orientation="vertical">
                        <a role="menuitem" class="menu-item" href="{% url 'shop' %}" onclick="closeMenu(); return true;">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="1.5 1.97 21 19.78" stroke-width="2" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"></path>
                            </svg>
                            <span>Home</span>
                        </a>
                        <a role="menuitem" class="menu-item" href="#" onclick="openTrackOrder(); closeMenu(); return false;">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"></path>
                            </svg>
                            <span>Track Order</span>
                        </a>
                        <div class="menu-divider"></div>
                        <a role="menuitem" class="menu-item" href="#" onclick="setLanguage('en'); return false;">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="2.25 2.25 19.79 19.5" stroke-width="2" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 3v1.5M3 21v-6m0 0 2.77-.693a9 9 0 0 1 6.208.682l.108.054a9 9 0 0 0 6.086.71l3.114-.732a48.524 48.524 0 0 1-.005-10.499l-3.11.732a9 9 0 0 1-6.085-.711l-.108-.054a9 9 0 0 0-6.208-.682L3 4.5M3 15V4.5"></path>
                            </svg>
                            <span>English (EN)</span>
                        </a>
                    </div>
                </div>
            </div>
            <div class="logo" onclick="window.location.href='{% url 'shop' %}'">
                <div class="logo-icon">
                    <img src="{% static 'common/images/logos/madam-da-logo.png' %}" alt="MADAM DA Logo" onerror="this.style.display='none'; this.parentElement.innerHTML='MD';">
                </div>
                <h1>MADAM DA</h1>
            </div>
            <div class="header-actions">
                <button class="icon-btn" onclick="window.location.href='{% url 'checkout' %}'" aria-label="View cart" title="View cart">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="2.37 1.5 19.25 21" stroke-width="1.5" stroke="currentColor" class="cart-icon" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119 1.007zM8.625 10.5a.375.375 0 11-.75 0 .375.375 0 01.75 0zm7.5 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"></path>
                    </svg>
                    <span class="cart-badge hidden" id="header-badge" aria-live="polite">0</span>
                </button>
            </div>
        </div>
    </header>

    <!-- HERO CAROUSEL -->
    <div class="hero" id="hero">
        {% if hero_slides %}
            {% for slide in hero_slides %}
                <div class="hero-slide {% if forloop.first %}active{% endif %}">
                    {% if slide.slide_type == 'video' and slide.video %}
                        <video class="hero-video" autoplay muted loop playsinline>
                            <source src="{{ slide.video.url }}" type="video/mp4">
                        </video>
                    {% elif slide.slide_type == 'image' and slide.image %}
                        <div class="hero-bg" style="background-image: url('{{ slide.image.url }}');"></div>
                    {% elif slide.slide_type == 'url' and slide.external_url %}
                        <div class="hero-bg" style="background-image: url('{{ slide.external_url }}');"></div>
                    {% endif %}
                    <div class="hero-overlay"></div>
                </div>
            {% endfor %}
        {% else %}
            <!-- Default slides if no slides in database -->
            <div class="hero-slide active">
                <div class="hero-bg" style="background-image: url('https://images.unsplash.com/photo-1596704017254-9b121068ec31?q=80&w=2574&auto=format&fit=crop');"></div>
                <div class="hero-overlay"></div>
            </div>
        {% endif %}
        
        <div class="hero-dots">
            {% if hero_slides %}
                {% for slide in hero_slides %}
                    <div class="hero-dot {% if forloop.first %}active{% endif %}" onclick="setHeroSlide({{ forloop.counter0 }})"></div>
                {% endfor %}
            {% else %}
                <div class="hero-dot active" onclick="setHeroSlide(0)"></div>
            {% endif %}
        </div>
    </div>

    <!-- SHOP VIEW -->
    <div class="view active" id="shop-view">
        <div class="shop-container">
            <div class="section-header">
                <span class="section-label">Premium Collection</span>
                <h2 class="section-title">Featured Products</h2>
                <p class="section-desc">Curated selection of luxury beauty essentials for modern elegance</p>
            </div>

            <div class="product-grid" id="product-grid">
                {% for product in products %}
                <div class="product-card" data-id="{{ product.id }}" data-stock="{{ product.stock }}">
                    {% if product.stock <= 0 %}
                        <div class="product-badge product-badge-out-of-stock">Out of Stock</div>
                    {% elif product.badge %}
                        <div class="product-badge">{{ product.badge }}</div>
                    {% elif product.badge_kh %}
                        <div class="product-badge">{{ product.badge_kh }}</div>
                    {% endif %}
                    <div class="product-image-wrap">
                        {% if product.image_urls %}
                        <picture>
                            {% if product.image_urls.webp_srcset %}
                            <source srcset="{{ product.image_urls.webp_srcset }}" sizes="(max-width: 640px) 400px, (max-width: 1024px) 600px, 1200px" type="image/webp">
                            {% endif %}
                            {% if product.image_urls.png_srcset %}
                            <source srcset="{{ product.image_urls.png_srcset }}" sizes="(max-width: 640px) 400px, (max-width: 1024px) 600px, 1200px" type="image/png">
                            {% endif %}
                            <img src="{{ product.image_urls.webp|default:product.image_urls.png|default:product.image }}" 
                                 alt="{{ product.name }}" 
                                 class="product-image" 
                                 loading="lazy" 
                                 decoding="async" 
                                 width="260" 
                                 height="312" 
                                 onerror="this.onerror=null; this.src='{{ product.image_urls.png|default:product.image }}';">
                        </picture>
                        {% else %}
                        <img src="{{ product.image }}" alt="{{ product.name }}" class="product-image" loading="lazy" decoding="async" width="260" height="312">
                        {% endif %}
                    </div>
                    <div class="product-info">
                        <h3 class="product-name">{{ product.name }}</h3>
                        {% if product.name_kh and product.name != product.name_kh %}<p class="product-name-kh" style="font-size: 0.85em; color: #666; margin-top: 4px;">{{ product.name_kh }}</p>{% endif %}
                        <div class="product-price">
                            <span class="price-current">${{ product.price|floatformat:2 }}</span>
                            {% if product.old_price %}<span class="price-old">${{ product.old_price|floatformat:2 }}</span>{% endif %}
                        </div>
                        {% if product.stock <= 0 %}
                            <button class="btn-add-cart btn-out-of-stock" disabled aria-label="{{ product.name }} is out of stock" title="Out of stock">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="2.37 1.5 19.25 21" stroke-width="1.5" stroke="currentColor" class="cart-icon-small" aria-hidden="true">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119 1.007zM8.625 10.5a.375.375 0 11-.75 0 .375.375 0 01.75 0zm7.5 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"></path>
                                </svg>
                                Out of Stock
                            </button>
                        {% else %}
                            <button class="btn-add-cart" onclick="addToCart('{{ product.id }}')" aria-label="Add {{ product.name }} to cart" title="Add to cart">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="2.37 1.5 19.25 21" stroke-width="1.5" stroke="currentColor" class="cart-icon-small" aria-hidden="true">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119 1.007zM8.625 10.5a.375.375 0 11-.75 0 .375.375 0 01.75 0zm7.5 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"></path>
                                </svg>
                                Add to Cart
                            </button>
                        {% endif %}
                        <div class="qty-control">
                            <button class="qty-btn" onclick="updateCartQty('{{ product.id }}', -1)">âˆ’</button>
                            <div class="qty-value">1</div>
                            <button class="qty-btn" onclick="updateCartQty('{{ product.id }}', 1)">+</button>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- FLOATING CART BAR -->
    <div class="floating-cart" id="floating-cart">
        <a class="floating-cart-link" href="{% url 'checkout' %}">
            <div class="cart-left">
                <div class="cart-thumbs-wrapper" id="cart-thumbs"></div>
                <p class="cart-dot">.</p>
                <p class="cart-count-text"><span id="cart-count">0</span> Products</p>
            </div>
            <div class="cart-right">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" class="cart-checkout-icon" viewBox="2.25 2.25 19.5 19.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m-3-2.818.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"></path>
                </svg>
                <span class="cart-checkout-text">Checkout</span>
            </div>
        </a>
    </div>

    <!-- MOBILE NAVIGATION -->

    <!-- TRACK ORDER MODAL -->
    <div class="track-order-modal" id="track-order-modal">
        <div class="track-order-content">
            <div class="track-order-header">
                <h2>ðŸ“¦ Track Your Order</h2>
                <button class="close-modal-btn" onclick="closeTrackOrder()">Ã—</button>
            </div>
            <form class="track-order-form" id="track-order-form" onsubmit="event.preventDefault(); trackOrder();">
                <div class="form-group">
                    <label class="form-label" for="track-order-number">Order Number</label>
                    <input type="text" id="track-order-number" class="form-input" placeholder="e.g., MD00001" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="track-phone">Phone Number</label>
                    <input type="tel" id="track-phone" class="form-input" placeholder="e.g., 012345678" required>
                </div>
                <button type="submit" class="track-btn" id="track-submit-btn">Track Order</button>
            </form>
            <div class="track-result" id="track-result"></div>
        </div>
    </div>

    <!-- FOOTER -->
    <footer>
        <div class="footer-content">
            <h2 class="footer-logo">MADAM DA</h2>
            <p class="footer-text">
                Experience the pinnacle of luxury beauty.<br>
                Crafted with care in Cambodia.
            </p>
            <div class="footer-links">
                <a href="{% url 'about_us' %}" class="footer-link">About Us</a>
                <a href="{% url 'contact' %}" class="footer-link">Contact</a>
                <a href="#" onclick="openTrackOrder(); return false;" class="footer-link">Track Order</a>
                <a href="{% url 'shipping_policy' %}" class="footer-link">Shipping Policy</a>
                <a href="{% url 'privacy_policy' %}" class="footer-link">Privacy</a>
            </div>
            <div class="footer-bottom">
                Â© 2025 MADAM DA. All rights reserved.
            </div>
        </div>
    </footer>

    
    <!-- Inline script for PRODUCTS array (needs Django template processing) -->
    <script>
        // ========== PRODUCTS DATA ==========
        const PRODUCTS = [
            {% for product in products %}
            {
                id: '{{ product.id }}',
                name: '{{ product.name|escapejs }}',
                nameEn: '{{ product.name|escapejs }}',
                nameKh: {% if product.name_kh %}'{{ product.name_kh|escapejs }}'{% else %}null{% endif %},
                price: {{ product.price }},
                oldPrice: {% if product.old_price %}{{ product.old_price }}{% else %}null{% endif %},
                image: '{% if product.image_urls %}{{ product.image_urls.webp|default:product.image_urls.png|default:product.image }}{% else %}{{ product.image }}{% endif %}',
                stock: {{ product.stock }},
                badge: {% if product.badge %}'{{ product.badge|escapejs }}'{% else %}null{% endif %},
                badgeKh: {% if product.badge_kh %}'{{ product.badge_kh|escapejs }}'{% else %}null{% endif %}
            }{% if not forloop.last %},{% endif %}
            {% endfor %}
        ];
    </script>
    
    <script src="{% static 'shop/js/index.js' %}"></script>
</body>
</html>

